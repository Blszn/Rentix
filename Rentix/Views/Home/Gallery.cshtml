@model IEnumerable<Rentix.Models.Vehicle>
@{
    ViewData["Title"] = "Araç Galerisi";
}

<h2 class="text-center mb-4 text-primary">Müsait Araçlar</h2>

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        Şu anda kiralayabileceğiniz müsait araç bulunmamaktadır.
    </div>
}
else
{
    <div class="row">
        @foreach (var vehicle in Model)
        {
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm border-0 hover-card">

                    <div style="height: 250px; overflow: hidden; background-color: #f8f9fa;">
                        @if (vehicle.Images != null && vehicle.Images.Any())
                        {
                            // Her araç için BENZERSİZ bir carousel ID'si oluşturuyoruz.
                            var carouselId = "carousel-vehicle-" + vehicle.Id;

                            <div id="@carouselId" class="carousel slide h-100" data-bs-ride="carousel" data-bs-interval="false">
                                <div class="carousel-inner h-100">
                                    @for (int i = 0; i < vehicle.Images.Count; i++)
                                    {
                                        // İlk resme 'active' sınıfını ekle
                                        var activeClass = (i == 0) ? "active" : "";
                                        var image = vehicle.Images.ElementAt(i);

                                        <div class="carousel-item @activeClass h-100">
                                            <img src="@image.ImageUrl" class="d-block w-100 h-100" style="object-fit: cover;" alt="@vehicle.Brand @vehicle.Model">
                                        </div>
                                    }
                                </div>

                                @if (vehicle.Images.Count > 1)
                                {
                                    <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon bg-dark bg-opacity-50 rounded-circle p-2" aria-hidden="true"></span>
                                        <span class="visually-hidden">Önceki</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                                        <span class="carousel-control-next-icon bg-dark bg-opacity-50 rounded-circle p-2" aria-hidden="true"></span>
                                        <span class="visually-hidden">Sonraki</span>
                                    </button>
                                }
                            </div>
                        }
                        else
                        {
                            <img src="https://placehold.co/600x400/203a43/ffffff?text=@vehicle.Brand+@vehicle.Model" class="card-img-top h-100 w-100" style="object-fit: cover;" alt="No Image">
                        }
                    </div>

                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title fw-bold mb-0">@vehicle.Brand @vehicle.Model</h5>
                            <span class="badge bg-secondary">@vehicle.Year</span>
                        </div>

                        <p class="text-muted small">
                            Plaka: @(string.IsNullOrEmpty(vehicle.PlateNumber) || vehicle.PlateNumber.Length < 4
                                                ? vehicle.PlateNumber
                                                : $"{vehicle.PlateNumber.Substring(0, 2)}***{vehicle.PlateNumber.Substring(vehicle.PlateNumber.Length - 2)}")
                        </p>

                        <h4 class="text-primary fw-bold mt-3">
                            @vehicle.DailyPrice.ToString("C2")
                            <small class="text-muted fs-6 fw-normal">/ Günlük</small>
                        </h4>
                    </div>

                    <div class="card-footer bg-white border-top-0 pb-3">
                        <div class="d-grid">
                            <a asp-controller="Rentals"
                               asp-action="Rent"
                               asp-route-id="@vehicle.Id"
                               /* Eğer arama yaptıysa tarihleri taşı, yapmadıysa boş geç * /
                               asp-route-startDate="@ViewBag.SearchStart?.ToString("yyyy-MM-dd")"
                               asp-route-endDate="@ViewBag.SearchEnd?.ToString("yyyy-MM-dd")"
                               class="btn btn-primary">
                                <i class="bi bi-key-fill"></i> Hemen Kirala
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}

<style>
    .hover-card { transition: transform 0.2s ease-in-out; }
    .hover-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }

    /* Carousel oklarını biraz daha belirgin yapalım */
    .carousel-control-prev-icon, .carousel-control-next-icon {
        background-size: 60%;
    }
</style>